version: 2.4.1-branch-{branch}-build-{build}

# Skipping commits affecting specific files (GitHub only). More details here: https://www.appveyor.com/docs/appveyor-yml
skip_commits:
  files:
    - .ci/travis-*.sh
    - .github/*
    - .tx/*
    - webclient/*
    - .*ignore
    - .codacy.yml
    - .gitlab-ci.yml
    - .travis.yml
    - '*.md'
    - Dockerfile
    - LICENSE

image: Visual Studio 2017

services:
    - mysql

cache:
    - c:\openssl-release
    - c:\protobuf-release
    - c:\zlib-release

environment:
    matrix:
        - qt_ver: 5.9\msvc2017_64
          openssl_ver: 1.0.2n-x64_86-win64
          protobuf_ver: 3.5.1
          zlib_ver: 1.2.11
          cmake_generator: Visual Studio 15 2017 Win64
          cmake_toolset: v141,host=x64
          target_arch: x86_64
          vc_arch: amd64
        - qt_ver: 5.9\msvc2015 # Qt doesn't provide a msvc2017_32
          openssl_ver: 1.0.2n-i386-win32
          protobuf_ver: 3.5.1
          zlib_ver: 1.2.11
          cmake_generator: Visual Studio 15 2017
          cmake_toolset: v141
          target_arch: x86
          vc_arch: amd64_x86


install:
    - ps: .\.ci\appveyor-dependencies.ps1

before_build:
    - ps: .\.ci\appveyor-create_solutions.ps1

build_script:
    - msbuild PACKAGE.vcxproj /p:Configuration=Release

after_build:
    - ps: ..\.ci\appveyor-create_artifacts.ps1


test: off


# Builds for pull requests skip the deployment step altogether
deploy:
# Deploy configuration for "beta" releases
  - provider: GitHub
    auth_token:
      secure: p+7wPVry2XEa6TBm9XH8IaQZbBmXQ/J2ldbGmcIxUZD3NkkPrSRRlmE7Of1CBBIO
    tag: "$(APPVEYOR_REPO_TAG_NAME)"
    release: "Cockatrice $(APPVEYOR_REPO_TAG_NAME)"
    description: "Beta release of Cockatrice"
    artifact: /.*\.exe/
    force_update: true
    draft: false
    prerelease: true
    on:
      APPVEYOR_REPO_TAG: true
      APPVEYOR_REPO_TAG_NAME: /([0-9]|[1-9][0-9])(\.([0-9]|[1-9][0-9])){2}-beta(\.([2-9]|[1-9][0-9]))?$/    # regex to match semver naming convention for beta pre-releases

# Deploy configuration for "stable" releases
  - provider: GitHub
    auth_token:
       secure: p+7wPVry2XEa6TBm9XH8IaQZbBmXQ/J2ldbGmcIxUZD3NkkPrSRRlmE7Of1CBBIO
    tag: "$(APPVEYOR_REPO_TAG_NAME)"
    release: "Cockatrice $(APPVEYOR_REPO_TAG_NAME)"
    artifact: /.*\.exe/
    force_update: true
    draft: false
    prerelease: false
    on:
      APPVEYOR_REPO_TAG: true
      APPVEYOR_REPO_TAG_NAME: /([0-9]|[1-9][0-9])(\.([0-9]|[1-9][0-9])){2}$/    # regex to match semver naming convention for stable full releases


# official validator for ".appveyor.yml" config file: https://ci.appveyor.com/tools/validate-yaml
# appveyor config documentation: https://www.appveyor.com/docs/build-configuration/
