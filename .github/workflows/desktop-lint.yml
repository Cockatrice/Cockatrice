name: Code Style (C++) 

on:
  pull_request:
    paths:
      - '*/**'    # matches all files not in root
      - '!**.md'
      - '!.ci/**'
      - '!.github/**'
      - '!.husky'
      - '!.tx'
      - '!doc/**'
      - '!webclient/**'
      - '.github/workflows/desktop-lint.yml'
      - '.ci/lint_cpp.sh'
      - '.clang-format'
      - '.cmake-format.json'
      - 'format.sh'

jobs:
  format:
    runs-on: ubuntu-22.04

    steps:
    - name: Checkout
      uses: actions/checkout@v5
      with:
        fetch-depth: 20 # should be enough to find merge base

    - name: Install dependencies
      shell: bash
      run: |
        sudo apt-get update
        sudo apt-get install -y --no-install-recommends clang-format cmake-format

    - name: Check code formatting
      shell: bash
      run: ./.ci/lint_cpp.sh
